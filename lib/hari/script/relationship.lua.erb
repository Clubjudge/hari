<%= locals_from_args %w(relation direction limit skip step result_type return) %>

local <%= l(:result) %> = {}

<% if result_type == :nodes_ids %>
  <%= l(:result) %> = _h.fetch_nodes_ids(start_node_id, <%= l(:relation, :direction, :skip, :limit) %>, _h)
<% elsif result_type == :relations_ids %>
  <%= l(:result) %> = _h.fetch_relations_ids(start_node_id, <%= l(:relation, :direction, :skip, :limit) %>, _h)
<% elsif result_type == :nodes %>
  <%= l(:result) %> = _h.fetch_nodes_ids(start_node_id, <%= l(:relation, :direction, :skip, :limit) %>, _h)
  <%= l(:result) %> = _h.map(<%= l(:result) %>, function(r) return 'hari:'..r end)
  <%= l(:result) %> = redis.call('mget', unpack(<%= l(:result) %>))
<% end %>

<% if result %>
  return <%= l(:result) %>
<% end %>
